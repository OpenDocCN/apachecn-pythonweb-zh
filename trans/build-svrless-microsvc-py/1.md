# 无服务器微服务体系结构和模式

微服务体系结构基于服务。您可以将微服务视为 SOA 的轻量级版本，但它丰富了更新的体系结构，例如事件驱动体系结构，其中事件被定义为感兴趣的变化状态。在本章中，您将了解单片多层体系结构和单片**面向服务架构**（**SOA**）。我们将讨论这两种体系结构的优缺点。我们还将了解微服务的背景，以了解其增长背后的基本原理，并比较不同的体系结构。

我们将介绍设计模式和原则，并介绍无服务器微服务集成模式。然后，我们将介绍通信样式和分解微服务模式，包括同步和异步通信。

然后，您将了解如何使用 AWS 中的无服务器计算在云中快速部署事件驱动计算和微服务。我们通过设置无服务器 AWS 和开发环境来结束本章。

在本章中，我们将介绍以下主题：

*   了解不同的体系结构类型和模式
*   虚拟机、容器和无服务器计算
*   微服务集成模式概述
*   通信方式和分解微服务模式
*   AWS 中的无服务器计算
*   设置无服务器环境

# 了解不同的体系结构类型和模式

在本节中，我们将讨论不同的体系结构，如单片和微服务，以及它们的优缺点。

# 单片多层体系结构和单片面向服务体系结构

在我职业生涯之初，当我为凯捷全球财富 500 强客户工作时，我们倾向于使用多层体系结构，在这种体系结构中，您可以创建不同的物理独立层，您可以独立更新和部署。例如，如以下三层架构图所示，您可以使用**表示**、**域逻辑**、**数据存储**层：

![](assets/bea0b9fd-ac92-414b-8a9c-19b3cb34d6c6.png)

在**表示层**中，您拥有用户界面元素和任何与表示相关的应用程序。在**域逻辑**中，您拥有所有业务逻辑以及与从表示层传递数据有关的任何内容。域逻辑中的元素还处理将数据传递到**存储或数据层**，该存储或数据层具有数据访问组件和任何数据库元素或文件系统元素。例如，如果要将数据库技术从 SQL Server 更改为 MySQL，只需更改数据访问组件，而不必修改表示层或域逻辑层中的元素。这使您能够将存储类型与表示和业务逻辑分离，从而通过交换数据存储层更容易地更改数据库技术。

几年后，在凯捷，我们使用 SOA 实现了客户的项目，SOA 比多层体系结构更细粒度。基本上，这是一个标准化服务合同和注册的想法，允许自动化和抽象化：

![](assets/e74da850-9729-42de-bc3a-8af79fb09645.png)

有四个与 SOA 相关的重要服务属性：

*   每个服务都需要有一个清晰的业务活动，该活动与企业中的一个活动相链接。
*   任何使用该服务的人都不需要了解其内部工作原理。
*   所有信息和系统都是自包含和抽象的。
*   为了支持其可组合性，服务可以由其他底层服务组成

以下是一些重要的 SOA 原则：

*   标准化
*   松耦合
*   摘要
*   无国籍
*   由颗粒构成的
*   组合的
*   可发现
*   可重复使用的

第一个原则是有一个**标准化的**服务合同。这基本上是一个在企业级定义的通信协议，这样当您使用一个服务时，您就可以确切地知道它是哪一个服务、传递消息的契约以及您将得到什么。这些服务是**松散耦合的**。这意味着它们可以自主工作，但您也可以从企业网络中的任何位置访问它们。它们还提供了一个**摘要**版本，这意味着这些服务是一个黑匣子，内部逻辑实际上隐藏在其中，但它们也可以独立于其他服务工作。

一些服务也将是无状态的。这意味着，如果您调用一个服务，传入一个请求，您将得到一个响应，如果服务或负载出现问题，您也会得到一个异常。粒度在 SOA 中也非常重要。该服务需要足够的**粒度**，以使其不会被低效或多次调用。因此，我们希望规范化服务的级别和粒度。如果某些服务被服务重用，则可以对其进行分解，或者可以将服务连接在一起并进行规范化以最小化冗余。服务还需要是**可组合的**，以便您可以将它们合并到更大的服务中或将它们拆分。

有一套标准化的合同，但服务也需要**可发现**。可发现意味着有一种方法可以自动发现哪些服务可用，哪些端点可用，以及一种解释它们的方法。最后，合理的元素**重用**对于 SOA 来说非常重要，因为此时逻辑可以在代码库的其他部分重用。

# 单片体系结构的好处

在 SOA 中，体系结构是松散耦合的。企业的所有服务都在一个存储库中定义。这使我们能够很好地了解可用的服务。此外，还有一个全局数据模型。通常，有一个数据存储区，我们在其中存储所有数据源，每个单独的服务实际对其进行写入或读取。这使得它能够在全球级别集中。

另一个好处是通常有少量的大型服务，它们由明确的业务目标驱动。这使我们的组织易于理解并保持一致。通常，服务之间的通信通过智能管道或某种中间件进行解耦。

# 单片结构的缺点

单片体系结构的缺点是通常只有一个技术堆栈。这意味着应用服务器、web 服务器或数据库框架在整个企业中是一致的。过时的库和代码可能很难升级，因为这依赖于单个堆栈，几乎就像所有服务都需要在同一版本的库上对齐一样。

另一个缺点是，单堆栈上的代码库通常非常大，这意味着构建和部署代码需要很长的构建时间和测试时间。这些服务部署在单个或大型应用程序服务器和 web 服务器集群上。这意味着，为了扩展，您需要扩展整个服务器，这意味着无法独立部署和扩展应用程序。要扩展应用程序，需要扩展 web 应用程序或承载该应用程序的应用程序服务器。

另一个缺点是，通常有一个集中的中间件编排层或集成逻辑。例如，服务将使用**业务流程管理**（**BPM**框架来控制工作流，您将使用**企业服务总线**（**ESB**来允许您集中路由消息，或者您可以使用某种中间件来处理服务之间的集成。很多这种逻辑都集中在一起，在更改这种集中逻辑的配置时，必须非常小心，不要中断任何服务间通信。

# 微服务概述

微服务这个术语起源于 2011 年的一个研讨会，当时不同的团队描述了他们所使用的架构风格。2012 年，Netflix 的 Adrien Cockcroft 实际上将微服务描述为一种细粒度 SOA，他是 web 级细粒度 SOA 的先驱。

例如，如果我们在**物联网**（**物联网**设备）上安装了传感器，如果温度发生变化，我们将发出一个事件作为可能的警告，进一步向下游发送。这就是所谓的**事件流处理**或**复杂事件处理**。本质上，整个体系结构中的所有事情都是由事件驱动的。

微服务中使用的另一种设计类型称为**域驱动设计**（**DDD**。这基本上是领域专家和开发人员之间有共同语言的地方。DDD 中的另一个重要组件是**有界上下文**，这是一个严格的一致性模型，依赖于每个服务的边界。例如，如果是处理客户发票的服务，则该服务将是中心点，也是唯一可以处理、写入或更新客户发票的地方。这样做的好处是，在有限上下文之外的系统中，不会对数据访问的责任产生任何混淆。

您可以将 microservice 看作是以使用 JSON 标准的 REST 端点或应用程序编程接口为中心的。许多逻辑可以内置到服务中。这就是所谓的**哑管道**，但它是一个智能端点，您可以在图中看到原因。我们提供的服务涉及客户支持，如下所示：

![](assets/f3d55bc0-8bb3-4266-9b5d-4570fbcd6e88.png)

例如，端点将更新客户支持详细信息、添加新票据或获取具有特定标识符的客户支持详细信息。我们有一个本地的客户支持数据存储区，因此所有关于客户支持的信息都存储在该数据存储区中，您可以看到微服务发出客户支持事件。通过发布-订阅机制或使用其他发布事件框架发送，如**命令查询责任分离**（**CQRS**。您可以看到，这符合有界上下文。在这个有限的环境中，有一个单一的责任。因此，该微服务控制着客户支持的所有信息。

# 微服务体系结构的优缺点

有限的上下文，以及这是一个非常小的代码库的事实，允许您非常频繁地构建和部署。此外，您还可以独立扩展这些服务。每个微服务通常有一个应用服务器或 web 服务器。显然，您可以非常快速地扩展它，只针对您想要的特定服务。此外，您可以拥有更频繁测试的频繁构建，并且可以使用任何类型的语言、数据库或 web 应用服务器。这使它成为一个多边形系统。有界上下文非常重要，因为您可以对一个域进行建模。功能可以很快发布，因为，例如，客户服务微服务实际上可以控制对数据的所有更改，因此您可以更快地部署这些组件。

然而，使用微服务体系结构有一些缺点。首先，分布式开发和测试非常复杂。此外，这些服务的通话量更大，因此网络流量也更多。延迟和网络在微服务中变得非常重要。DevOps 团队必须维护并监控从其他服务获得响应所需的时间。此外，责任的变更是另一个复杂问题。例如，如果我们要将一个有界上下文拆分为若干类型的子有界上下文，您需要考虑这在团队中是如何工作的。通常还需要一个专门的 DevOps 团队，该团队主要用于支持和维护整个组织中数量多得多的服务和机器。

# SOA 与微服务

现在我们已经对这两种架构有了很好的理解，我们将比较 SOA 和微服务架构。就通信本身而言，SOA 和微服务都可以使用同步和异步通信。SOA 通常依赖于**简单对象访问协议**（**SOAP**或 web 服务。微服务趋向于更加现代化和广泛使用**代表性状态转移**（**REST**）**应用程序编程接口**（**API**）。

我们将从下图开始，该图比较了 SOA 和微服务：

![](assets/d0e8b0cf-57f9-44e9-a02b-959a6a179109.png)

编排是一个巨大的差异。在 SOA 中，一切都集中在 BPM、ESB 或某种中间件周围。服务和数据流之间的所有集成都由中央控制。这允许您在一个地方配置任何更改，这有一些优点。

微服务方法已经使用了一种更基于编排的方法。这是单个服务更智能的地方，也就是说，一个智能端点，但一个哑管道。这意味着这些服务确切地知道该呼叫谁以及他们将获得哪些数据，并且它们在微服务中管理该过程。这在集成微服务方面为我们提供了更大的灵活性。在 SOA 世界或三层体系结构中，灵活性较低，因为它通常是一个单一的代码库，而集成是一组庞大的用户界面或后端服务的整体发布和部署。这可能会限制企业的灵活性。然而，对于微服务来说，这些系统要小得多，可以单独部署，而且粒度要细得多。

最后，在体系结构方面，SOA 在企业级工作，在企业级我们将有一个企业架构师或解决方案架构师模型，并控制中央存储库中所有服务的发布。微服务更加灵活。Microservices 谈到了在项目层面上的工作，他们说团队只由一些开发人员组成，或者只有极少数的开发人员可以坐在一起分享比萨饼。因此，这为您在项目级别快速做出决策提供了更大的灵活性，而不必在企业级别达成一致。

# 虚拟机、容器和无服务器计算

现在我们对单片和微服务架构有了更好的理解，让我们看看创建无服务器微服务的**Amazon Web Service**（**AWS**）构建块。

但首先我们将介绍虚拟机、容器和无服务器计算，它们是公共云中托管的任何应用程序或服务背后的基本构建块。

虚拟机是公共云和 web 托管站点的原始产品，容器是轻量级独立映像，无服务器计算是云提供商完全管理资源的时候。您将了解每种方法的优缺点，我们将详细比较这三种方法。

# 虚拟机

在传统的数据中心中，您必须购买或租赁物理机器，并有多余的容量来处理额外的 web 或用户流量。在新世界，虚拟机是首批公共云产品之一。您可以将其视为类似于物理机箱，您可以在其中安装操作系统，通过 SSH 或 RDP 进行远程连接，并安装应用程序和服务。我要说的是，虚拟机一直是初创公司取得成功的关键基石之一。它使他们能够只需少量资本投资就可以进入市场，并随着网络流量和用户量的增加而扩展。考虑到物理硬件的巨大前期成本，这是以前只有大型组织才能负担得起的。

虚拟机的优势在于按使用量付费、实例类型的选择和存储的动态分配，使您的组织能够在几分钟内租用硬件，而不是等待购买物理硬件。虚拟机还提供安全性，由云提供商管理。此外，它们还提供多区域自动扩展和负载平衡，同样由云提供商管理，几乎只需点击一个按钮即可使用。有许多可用的虚拟机，例如 AmazonEC2、Azure 虚拟机和 Google 计算引擎。

然而，它们确实有一些缺点。主要缺点是需要几分钟的时间来扩展。因此，任何需要旋转的机器都需要几分钟的时间，这使得它不可能根据请求快速扩展。在配置方面，也需要像 Chef 或 Puppet 这样的人来进行配置管理。例如，操作系统需要保持最新。

另一个缺点是，您仍然需要编写逻辑来轮询或订阅其他托管服务，例如流分析服务。此外，您仍需为闲置机器时间付费。例如，当您的服务未运行时，虚拟机仍处于运行状态，即使它们未被积极使用，您仍在为此时间付费。

# 容器

使用虚拟机的旧方法是使用配置管理工具（如 Chef 或 Puppet）在主机操作系统上部署应用程序。这样做的好处是可以相互管理应用程序工件库和生命周期，并尝试操作特定的操作系统，无论是 Linux 还是 Windows。容器摆脱了这个限制，它的想法是将代码和依赖项放入一个可移植的容器中，在这个容器中您可以实现完整的操作系统级虚拟化。实际上，您可以更好地利用计算机上的可用资源。

这些容器可以快速旋转，它们基本上是不变的，也就是说，操作系统、库版本和配置不能更改。基本思想是在这个可移植容器中提供代码和依赖项，可以通过配置在本地或服务器上重新创建环境。另一个重要方面是编排引擎。这是管理容器的关键。因此，您将拥有由 Kubernetes 或 Amazon**EC2 容器服务**（**ECS**）管理、部署和缩放的 Docker 映像。

缺点是，这些容器通常在几秒钟内扩展，这仍然太慢，无法根据每个请求实际调用新的容器。因此，您需要对它们进行预热，并且已经可以使用，这是有成本的。此外，集群和映像配置确实涉及一些 DevOps 工作。

最近 AWS 推出了 AWS Fargate 和**Elastic Kubernetes 服务**（**EKS**），这有助于减轻一些配置管理和支持工作，但您仍然需要 DevOps 团队来支持它们。

另一个缺点是需要与托管服务进行集成。例如，如果您正在处理流分析服务，您仍然需要编写轮询和订阅代码，以便将数据拉入应用程序或服务。

最后，与虚拟机一样，即使 Kubernetes 提供帮助，您仍然需要为正在运行的任何容器付费。它们可以在 EC2 实例上运行，因此您仍然需要在运行期间支付实际机器的费用，即使它没有被使用。

# 无服务器计算

您可以将服务计算视为关注业务逻辑，而不是围绕服务的所有基础架构配置管理和集成。在无服务器计算中，仍然存在服务器，只是您不管理服务器本身、操作系统或硬件，所有的可伸缩性都由云提供商管理。您没有访问原始机器的权限，也就是说，您不能 SSH 到该机器上。

好处是，您可以真正关注业务逻辑代码，而不是任何基础架构或入站集成代码，这是您作为一个组织为客户和客户增加的业务价值。

此外，安全性再次由云提供商管理，自动扩展和高可用性选项也由云提供商管理。例如，您可以根据请求的数量动态地启动更多实例。成本是每个执行时间，而不是每个空闲时间。

有不同的公共云无服务器产品。谷歌、Azure、AWS 和阿里云都有**功能即服务**（**FaaS**的概念。这是在一个函数中部署业务逻辑代码的地方，它周围的一切，例如安全性和可伸缩性，都由云提供商管理。

缺点是它们是无状态的，这意味着它们的生命周期很短。几分钟后，该函数中保持的任何状态都将丢失，因此必须将其保留在外部。它不适合长时间运行的进程。它的实例类型和持续时间确实有限。例如，AWS lambda 在终止前的持续时间为 15 分钟。外部库或打包在一起的任何自定义库的实际大小也有限制，因为这些 lambda 需要快速旋转。

# 比较虚拟机、容器和无服务器

让我们比较一下**基础设施即服务**（**IaaS**）、**容器即服务**（**CaaS**）和**功能即服务**（**FaaS**）。将 IaaS 视为虚拟机，将 CaaS 视为 Docker 容器池，将 Lambda 函数视为 FaaS 的一个示例。这是 IaaS、CaaS 和 FaaS 之间的比较：

![](assets/fedf31b9-02f4-4fc5-a91b-cd15342ebbb5.png)

绿色元素由用户管理，蓝色元素由云服务提供商管理。因此，在左边，您可以看到，与虚拟机一起使用的 IaaS，用户有很多责任。在 CaaS 中，操作系统级别由提供者管理，但您可以看到容器和运行时实际上是由用户管理的。最后，在右边的 FaaS 中，您可以看到核心业务逻辑代码和应用程序配置由用户管理。

那么，您如何在 AWS 世界中的 AWS Lambda 容器和 EC2 实例之间进行选择？查看以下图表：

![](assets/d331be81-1102-4713-8318-1f8037af398b.png)

如果我们将虚拟机与第一行的容器和 Lambda 函数进行比较，您会发现在维护、构建它以实现高可用性和管理方面需要一些配置工作。对于 Lambda 函数，这实际上是在预请求的基础上完成的。也就是说，它是请求驱动的。例如，如果有更多流量访问您的站点，AWS 将增加更多 lambda，以使其**高度可用**（**HA**）。

在灵活性方面，您可以完全访问虚拟机和容器，但使用 AWS Lambda，您可以使用默认硬件、默认操作系统，并且没有可用的**图形处理单元**（**GPU**）。好的一面是，您不需要对 Lambdas 进行升级或维护。

就可伸缩性而言，您需要提前规划虚拟机和容器。您需要配置容器或实例，并决定如何进行扩展。在 AWS Lambda 函数中，缩放是基于请求或数据卷的数量隐式的，因为您本机会得到更多或更少的 Lambda 并行执行。

虚拟机的推出通常只需几分钟，它们可能会持续运行数周。容器可以在几秒钟内旋转起来，并可以停留数分钟或数小时，然后才能进行处理。然而，Lambda 函数可以在大约 100 毫秒内启动，通常可以运行几秒钟或几分钟。

就状态而言，虚拟机和容器可以维护状态，即使这通常不是扩展的最佳实践。Lambda 函数总是无状态的，当它们终止执行时，内存中的任何东西都会被处理掉，除非它在 DynamoDB 表或 S3 bucket 之外持久化。

虚拟机和 Docker 容器需要自定义与 AWS 服务的集成。然而，在 Lambda 函数中，事件源可以使用和其他 AWS 服务（如 Kinesis、S3 和 API 网关）的内置集成将数据推送到 Lambda 函数。您所要做的就是将 Lambda 事件源订阅到一个 Kinesis 流，数据将被推送到 Lambda 及其业务逻辑代码中，这允许您决定如何处理和分析该数据。但是，对于 EC2 虚拟机和 ECS 容器，您需要使用 AWS SDK 或通过其他方式构建该自定义入站集成逻辑。

最后，在定价方面，EC2 实例是每秒定价的。他们还有一个使用市场价格的现货实例，这比按需实例便宜得多。容器也是如此，只是一个 EC2 实例上可以有多个容器。这可以更好地利用资源，而且成本更低，因为您可以灵活地在 EC2 实例之间分布不同的容器。对于 AWS Lambda 函数，定价为每 100 毫秒、调用次数和所需的**随机存取存储器**（**RAM**）数量。

# 微服务集成模式概述

在本节中，我们将讨论设计模式、设计原则，以及微服务体系结构模式如何与传统的微服务模式相关，以及如何应用于无服务器微服务。这些主题将帮助您获得不同集成模式的概述。

# 设计模式

模式是可重用的蓝图，是其他人所面临的类似问题的解决方案，并且已经在各种生产环境中得到了广泛的审查、测试和部署。

遵循它们意味着您将受益于最佳实践和技术人员的智慧。您还将使用与其他开发人员或架构师相同的语言，这使您能够更快地交换想法，更轻松地与其他系统集成，并更有效地运行人员交接。

# 为什么模式有用？

有用的应用程序几乎从不孤立存在。它们几乎总是集成在更广泛的生态系统中，这对于微服务来说尤其如此。换句话说，集成规范和需求需要其他开发人员和架构师进行沟通和理解。

在使用模式时，您有一种在技术人群中使用的通用语言，使您能够被理解。它实际上是关于更好的合作，与他人合作，交流想法，以及研究如何解决问题。

模式的主要目的是在实现新服务时为您节省时间和精力，因为您有一个标准的术语和蓝图来构建一些东西。在某些情况下，它们可以帮助您避免陷阱，因为您可以从其他人的经验中学习，还可以应用最佳实践、软件、设计模式和原则。

# 软件设计模式和原则

您可能会在微服务或 Lambda 代码中使用**面向对象**（**OO**）或函数式编程，因此让我们简要介绍一下与它们相关的模式。

在 OO 编程中，有许多最佳实践模式或原则可以在编码时使用，例如 GRAP 或 SOLID。我不会深入讨论太多，因为这需要一整本书，但我想强调一些对微服务很重要的原则：

*   **坚实**：这有五个原则。一个例子是**单一责任原则**（**SRP**），其中您定义了每个类都有单一责任，因此只有一个变更原因，从而减少了服务的规模并提高了它们的稳定性。

*   **包内聚**：例如，一起改变的公共闭包原则类属于一起。因此，当业务规则更改时，开发人员只需要更改少量包中的代码。
*   **包耦合**：例如，非循环依赖原则，即包或组件的依赖关系图应该没有循环。

让我们简要介绍一下微服务的一些有用的设计模式：

*   **创建模式**：例如，工厂方法创建多个派生类的实例。
*   **结构模式**：例如，装饰者动态地向对象添加额外的职责。
*   **行为模式**：例如，命令模式将请求封装为对象，使得提取参数、排队和记录请求变得更容易。基本上，可以将创建命令的参数与执行命令的参数解耦。
*   **并发模式**：例如，reactor 对象为必须同步处理的资源提供异步接口。

根据您的编码经验，您可能熟悉这些。如果没有，那么值得一读，以提高代码的可读性、管理和稳定性，以及您的生产率。以下是一些参考资料，您可以从中了解更多信息：

*   *实体面向对象设计*，Sandi Metz（2009）
*   *设计模式：可重用面向对象软件的元素*，Erich Gamma，Richard Helm，Ralph Johnson，John Vlissides（1995）
*   *头先设计模式*、埃里克·T·弗里曼、伊丽莎白·罗布森、伯特·贝茨、凯西·塞拉（2004）
*   *敏捷软件开发，原则，模式和实践*，Robert C.Martin（2002）

# 无服务器微服务模式类别

除了我们刚才讨论的软件设计模式和原则之外，还有微服务模式。根据我的经验，我推荐了许多与无服务器微服务相关的微服务模式，如下图所示：

![](assets/8d29d8f6-35a6-40de-80a1-834b05b7179c.png)

我创建此图是为了总结和说明我们将在本书中讨论的无服务器微服务模式：

*   **沟通方式**：服务如何在一起和外部沟通。
*   **分解模式**：创建业务能力或有界上下文松散耦合的服务。
*   **数据管理**：处理本地和共享数据存储。
*   **查询和消息传递**：查看微服务之间发送的事件和消息，以及如何高效地查询服务。
*   **部署**：在理想情况下，我们希望统一和独立的部署，您也不希望开发人员为每个有界上下文或微服务重新创建新管道。
*   **可观察性和发现**：能够了解服务是否正常运行，监视和记录活动允许您在出现问题时向下钻取。例如，出于成本和维护原因，您还需要了解并监控当前运行的内容。
*   **安全**：这对于法规遵从性、数据完整性、数据可用性和潜在的财务损失至关重要。重要的是要有不同的加密、身份验证和授权流程。

接下来，我们将首先查看通信样式和分解模式。

# 通信方式和分解微服务模式

在本节中，我们将讨论两种微服务模式，称为**通信样式和**分解，详细程度足以让您与其他开发人员、架构师和 DevOp 讨论它们。

# 沟通方式

微服务应用程序本质上是分布式的，因此它们严重依赖于授权网络。这使得了解可用的不同通信方式变得非常重要。这些可以是相互交流，也可以是与外部世界交流。以下是一些例子：

*   **远程过程调用**：Java 过去流行使用**远程方法调用**（**RMI**），这是客户端和服务器之间使用非标准协议的紧密耦合，这是一个限制。此外，网络不可靠，因此应避免使用传统的 RMIs。与微服务中广泛采用的**表示性状态转移**（**REST**API 相比，其他的，例如 SOAP 接口和由**Web 服务定义语言**（**WSDL**生成的客户机更好，但被视为更重的重量。
*   **同步通信**：更易于理解和实现；您提出请求并得到响应。但是，在等待响应时，您可能还会阻塞连接插槽和资源，从而限制来自其他服务的呼叫：

![](assets/e68c630f-a5b1-4020-848e-9fe499bd2134.png)

*   **异步通信**：通过异步通信，您可以发出请求，然后稍后得到响应，有时甚至出现故障。可以使用回调、`async`/`await`或 Node.js 或 Python 中的`promise`来实现这些功能。然而，在使用`async`时有许多设计考虑因素，特别是当存在需要监控的故障时。与大多数同步调用不同，这些调用是非阻塞的：

![](assets/fdd67a03-5801-4e7d-a43a-ebd7644590bc.png)

在处理通信时，您还需要考虑您的呼叫是阻塞还是非阻塞。例如，使用阻塞调用将 web 客户端的度量写入 NoSQL 数据库可能会降低网站的速度。

您需要考虑接收太多的请求，并限制它们，以避免淹没您的服务，同时还要考虑失败，例如退休、延迟和错误。

当使用 Lambda 函数时，您可以从 AWS 构建的事件源中获益，并可以根据请求或使用微批数据旋转 Lambda。在大多数情况下，即使在规模上，同步代码也足够了，但在设计系统时，了解体系结构和服务之间的通信很重要，因为它受到带宽的限制，并且网络连接可能会失败。

# 一对一通信微服务模式

在单个微服务级别，数据管理模式由一套小型服务组成，具有自己的本地数据存储，与 REST API 通信或通过发布/订阅：

![](assets/ddf5c5a3-8611-4faf-adf6-82c51e72d5fe.png)

API 网关是所有客户端的单一入口点，并为它们量身定制，允许将更改与主微服务 API 分离，这对于面向外部的服务特别有用。

一对一请求/响应可以是同步的，也可以是异步的。如果它们是同步的，它们可以对每个请求都有响应。如果通信是异步的，它们可以有异步响应或异步通知。异步通常是首选的，可扩展性更高，因为它不保持开放连接（非阻塞），并且更好地利用了**中央处理器**（**CPU**）和**输入/输出**（**I/O**操作。

我们将在本书后面进一步详细介绍数据管理模式，我们将研究微服务如何集成到更广泛的生态系统中。

# 多对多通信微服务模式

对于多对多通信，我们使用发布/订阅，这是一种消息传递模式。在这种情况下，消息的发送者（称为发布者）不会对直接发送给特定接收者的消息进行编程；相反，接收者需要订阅消息。这是一种高度可扩展的模式，因为两者是解耦的：

![](assets/bff7dde7-7ef2-4bcc-a30d-1a73bdc65b50.png)

异步消息传递允许服务使用事件并根据事件进行操作，这是一种非常可扩展的模式，因为您已将两个服务解耦：发布者和订阅者。

# 按业务能力划分的分解模式

如何创建和设计微服务？*如果您正在迁移现有系统，您可能会考虑将整体或应用程序分解为微服务。即使是新的绿地项目，您也需要考虑所需的微服务：*

 *![](assets/9555cd6d-0cfe-46fb-8dd4-63502c44e717.png)

首先，您确定业务能力，即*一个组织为了产生价值做了什么*，而不是*如何*。也就是说，您需要分析目的、结构和业务流程。一旦确定了业务功能，就为每个功能或功能组定义了一个服务。然后，您需要添加更多细节，通过定义可用的方法或操作来了解服务的功能。最后，您需要设计服务的通信方式。

这种方法的好处是它相对稳定，因为它与您的业务提供的内容相关联。此外，它还与进程和地位有关。

缺点是数据可以跨多个服务，可能不是最佳通信或共享代码，并且需要一个集中的企业语言模型。

# 基于有界上下文的分解模式

通过有界上下文应用分解模式有三个步骤：首先，识别域，这是组织所做的。然后确定子域，即根据实际功能将交织的模型拆分为逻辑上分离的子域。最后，找到有界上下文，以标记出领域模型所使用的每个术语的含义在哪里得到了很好的理解。有界上下文不一定只属于单个子域。这三个步骤如下：

![](assets/19a03d89-0d19-469d-b4ed-d8c2fd3e5f0b.png)

这种模式的好处如下：

*   在与领域专家合作时使用无处不在的语言，这有助于更广泛的交流。
*   团队拥有、部署和维护服务，使他们能够灵活地在其有限的环境中进行更深入的理解。这很好，因为 it 中的服务最有可能相互通信。
*   该领域由具有代表性的领域专家的团队理解。有一个接口可以为其他团队抽象出许多实现细节。

还有一些缺点：

*   它需要领域专家。
*   它是迭代的，需要**持续集成**（**CI**才能到位。

*   对于一个简单的领域来说过于复杂，依赖于无处不在的语言和领域专家。
*   如果使用多语言的方法，可能没有人知道技术堆栈了。幸运的是，微服务应该更小、更简单，因此可以重写。

更多详细信息可在以下书籍中找到：

*   *建筑微服务*Sam Newman（2015）
*   *领域驱动设计：解决软件核心的复杂性*，Eric Evans（2003）
*   *实施领域驱动设计*，沃恩·弗农（2013）

# AWS 中的无服务器计算

AWS 中的无服务器计算允许您在云中快速部署事件驱动计算。使用无服务器计算，仍然有服务器，但您没有管理它们的能力。AWS 自动为您管理所有的计算资源，以及任何触发机制。例如，当一个对象被写入一个 bucket 时，就会触发一个事件。如果另一个服务向 Amazon DynamoDB 表写入新记录，则可能会触发要调用的事件或端点。

使用事件驱动计算的主要思想是，它可以轻松地让您在数据到达云端时转换数据，或者我们可以执行数据驱动的审计分析通知、转换或解析**物联网**（**物联网**设备事件。Serverless 还意味着您不需要一个始终运行的服务来实现这一点，您实际上可以根据事件触发它。

# AWS 中一些关键的无服务器服务概述

AWS 中的一些关键无服务器服务在以下列表中进行了说明：

*   **亚马逊简单存储服务（S3）**：一种高度可扩展、高度安全和可靠的分布式 web 级对象存储。您只需为实际使用的存储设备付费，这在定价方面是有益的。它还支持加密，您可以提供自己的密钥，也可以使用 AWS 提供的服务器端加密密钥。

*   **Amazon DynamoDB**：一种完全管理的 NoSQL store 数据库服务，由 AWS 管理，允许您专注于将数据写入数据存储。这是非常耐用和可用的。它已用于游戏和其他要求低延迟的高性能活动。它在引擎盖下使用 SSD 存储，还提供分区以实现高可用性。
*   **亚马逊简单通知服务（SNS）**：一种推送通知服务，允许您向其他订户发送通知。这些订户可以是电子邮件地址、SNS 消息或其他队列。消息将被推送到 SNS 服务的任何订户。
*   **亚马逊简单队列服务（SQS）**：一种完全管理、可扩展的分布式消息队列，具有高可用性和持久性。SQS 队列通常订阅 SNS 主题以实现分布式发布-订阅模式。你根据请求的数量为你使用的东西付费。
*   **AWS Lambda**：主要思想是编写业务逻辑代码，并根据您配置的事件源触发。美妙之处在于，您只需在代码实际执行时付费，最短为 100 毫秒。它可以自动伸缩，并且高度可用。它是 AWS 无服务器生态系统的关键组件之一。
*   **亚马逊 API 网关**：一种托管 API 服务，允许您构建、发布和管理 API。它可以按比例执行，还允许您在边缘位置执行缓存、流量调节和缓存，这意味着它们根据用户所在位置进行本地化，从而最大限度地减少总体延迟。此外，它与 AWS Lambda 函数进行了本机集成，使您能够专注于核心业务逻辑代码来解析该请求或数据。
*   **AWS 身份和访问管理（IAM）**：所有安全性的核心组件是 IAM 角色和策略，基本上是由 AWS 管理的一种机制，用于集中安全性并将其与其他服务联合。例如，可以将 Lambda 限制为仅读取特定的 DynamoDB 表，但不能写入同一 DynamoDB 表或拒绝对任何其他表的读/写访问。
*   **Amazon CloudWatch**：监控服务的中央系统。例如，您可以监视各种资源的利用率、记录自定义指标和主机应用程序日志。它对于创建在特定事件或异常发生时触发通知的规则也非常有用。

*   **AWS X-Ray**：一项允许您跟踪服务请求、分析延迟和来自各种来源的跟踪的服务。它还生成服务映射，因此您可以查看依赖关系以及在请求中花费的时间最多的位置，并对性能问题和错误进行根本原因分析。

*   **Amazon Kinesis Streams**：一项流式服务，允许您每秒捕获数百万个事件，以便在下游进行进一步分析。其主要思想是，例如，您将有数千台物联网设备直接写入 Kinesis 流，在一个管道中捕获数据，然后与不同的消费者进行分析。如果事件数量增加，您需要更多的容量，您可以简单地添加更多的碎片，每个碎片的容量为每秒 1000 次写入。添加更多的碎片很简单，因为没有停机时间，而且不会中断事件捕获。
*   **Amazon Kinesis Firehose**：一个允许您保存和加载流数据的系统。它允许您写入一个端点，该端点可以将内存中的事件缓冲 15 分钟，然后将其写入 S3。它支持海量数据，还与 Amazon Redshift 集成，后者是云中的数据仓库。它还与 Elasticsearch 服务集成，该服务允许您查询自由文本、web 日志和其他非结构化数据。
*   **亚马逊运动分析**：允许您使用**结构化查询语言**（**SQL**分析运动流中的数据。它还能够发现数据模式，以便您可以在流上使用 SQL 语句。例如，如果您正在捕获 web analytics 数据，您可以计算每日页面浏览量数据，并按特定的`pageId`进行汇总。
*   **Amazon Athena**：一种允许您在读取时使用模式直接查询 S3 的服务。它依赖于 AWS Glue 数据目录来存储表模式。您可以创建一个表，然后直接从 S3 查询数据，无需启动时间，无需服务器，并允许您以非常灵活且经济高效的方式探索海量数据集。

在所有这些服务中，AWS Lambda 是 AWS 中使用最广泛的无服务器服务。我们将在下一节中对此进行更多讨论。

# AWS Lambda

AWS 中的关键无服务器组件称为**AWS Lambda**。Lambda 基本上是一些可以由事件源触发的业务逻辑代码：

![](assets/f7d7e220-c772-4bff-bd0a-c72338bc5cf6.png)

**数据事件源**可以是一个对象对 S3 bucket 的 put 或 get。**流式事件源**可能是已发送到 DynamoDB 表并触发 Lambda 函数的新记录。其他流事件源包括 Kinesis 流和 SQS。

对端点的**请求的一个例子是来自 Alexa echo 设备的 Alexa skills。另一个流行的是 AmazonAPI 网关，当您调用将调用 Lambda 函数的端点时。此外，您可以在 AWS CodeCommit 或 Amazon Cloud Watch 中使用更改。**

最后，您可以基于 SNS 或不同的 cron 事件触发不同的**事件和消息。这些事件可能是常规事件，也可能是通知事件。**

其主要思想是事件源和 Lambda 之间的集成完全由 AWS 管理，因此您所需要做的就是编写业务逻辑代码，这就是函数本身。函数运行后，可以运行转换或某些业务逻辑代码，以实际写入图右侧的其他服务。这些可以是数据存储或调用其他端点。

在无服务器的世界中，您可以使用 AWS Lambdas 更轻松地实现`sync`/`asyc`请求、消息传递或事件流处理。这包括我们刚才提到的微服务通信风格和数据管理模式。

Lambda 有两种类型的事件源类型：非流事件源和流事件源：

*   **非流事件 sour****ces**：Lambdas 可以异步调用，也可以同步调用。例如，SNS/S3 是异步的，但 API 网关是同步的。对于同步调用，客户端负责重试，但对于异步调用，客户端将重试多次，然后再将其发送到**死信队列**（**DLQ**），如果已配置。AWS 事件源内置并支持这种重试逻辑和集成，这很好，因为这意味着更少的代码和更简单的体系结构：

![](assets/6c1d73bf-b123-4f70-b2a6-adc4dc64c557.png)

*   **流事件 so****源**：使用微批量数据调用 Lambda。就并发性而言，对于 Kinesis 流，每个碎片并行调用一个 Lambda，对于 DynamoDB 流，每个分区并行调用一个 Lambda。在 lambda 中，您只需要迭代作为 JSON 记录传入的 Kinesis 流、DynamoDB 或 SQS 数据。此外，您还受益于 AWS 内置的 streams 集成，其中 Lambda 将轮询流并按顺序检索数据，并在失败时重试，直到数据过期，对于 Kinesis 流，这可能长达七天。内置重试逻辑而无需编写一行代码也很好。如果您必须自己使用 AWS Consumer 或 Kinesis SDK 将其构建为 EC2 车队或容器，则需要付出更多的努力：

![](assets/f425d4fd-5e78-4b20-a8f3-1ae9ce6894f4.png)

实际上，AWS 负责调用事件数据并将其传递给 Lambda，您负责 Lambda 的处理和响应。

# 实现微服务模式的无服务器计算

以下是 AWS 上可用的一些无服务器和托管服务的概览图：

![](assets/80ef1c3f-73ad-4021-b836-9de72f9a6d9d.png)

利用 AWS 托管服务确实意味着额外的供应商锁定，但有助于降低非业务差异化的支持和维护成本。而且还可以更快地部署应用程序，因为基础架构可以在几分钟内配置或销毁。在某些情况下，当使用 AWS 托管服务实现微服务模式时，不需要太多代码，只需要配置。

我们提供以下服务：

*   **事件、消息和通知**：用于异步发布/订阅和协调组件
*   **API 和 web**：为您的无服务器微服务创建 API 并向 web 公开
*   **数据和分析**：存储、共享和分析您的数据
*   **监控**：确保您的微服务和堆栈正常运行
*   **授权和安全**：确保您的服务和数据是安全的，并且只有被授权的人才能访问

中心是 AWS Lambda，它是连接服务的粘合剂，也是部署业务逻辑源代码的关键位置之一。

# 示例用例–无服务器文件转换器

下面是一个示例用例，让您了解不同的 AWS 管理系统如何作为一个解决方案组合在一起。要求是第三方供应商每天随机向我们发送一个 10 MB 的小文件，我们需要转换数据并将其写入 NoSQL 数据库，以便实时查询。如果第三方数据有任何问题，我们希望在几分钟内发送警报。你的老板告诉你，他们不想让一台永远在线的机器仅仅用于此任务，第三方没有 API 开发经验，而且预算有限。安全负责人还发现了这个项目，并添加了另一个约束条件。他们不想让第三方访问您的 AWS 帐户，除了一个锁定的 S3 存储桶：

![](assets/995750b2-2975-43f6-8c44-a3277ba2c6ee.png)

这可以实现为事件驱动的无服务器堆栈。在左边，我们有一个 S3 存储桶，第三方可以在其中删除他们的文件。创建新对象时，将通过内置事件源映射触发 Lambda 调用。Lambda 执行代码来转换数据，例如，从对象中提取`user_id`、`date`和`event`类型等关键记录，并将它们写入 DynamoDB 表。Lambda 发送转换的摘要自定义度量，例如转换并写入 CloudWatch 度量的记录数。此外，如果存在转换错误，Lambda 会发送 SNS 通知，其中包含转换问题的摘要，这可能会向管理员和第三方提供商发送电子邮件，以便他们调查问题。

# 设置无服务器环境

如果您已经拥有 AWS 帐户并在本地进行了配置，则可以跳过此部分，但出于安全原因，我建议您启用**多因素身份验证**（**MFA**）进行控制台访问，并且不要在课程中使用根用户帐户密钥。

有三种方式可以访问 AWS 中的资源：

*   AWS 管理控制台是一个基于 web 的界面，用于管理您的服务和账单。
*   AWS 命令行界面是管理和自动化所有 AWS 服务的统一工具。
*   Python、JavaScript、Java、.NET 和 GO 中的软件开发工具包，允许您以编程方式与 AWS 交互。

# 设置您的 AWS 帐户

建立一个账户非常简单；您只需要大约五分钟，一部智能手机和一张信用卡：

1.  创建一个帐户。AWS 账户包括 12 个月的免费层访问：[https://aws.amazon.com/free/](https://aws.amazon.com/free/) 。
2.  输入您的姓名和地址。
3.  提供付款方式。
4.  核实你的电话号码。

这将创建一个根帐户，我建议您仅将其用于计费，而不用于开发

# 设立外交部

我建议您使用 MFA，因为它在您的用户名和密码之上添加了额外的保护层。将您的手机用作虚拟 MFA 设备是免费的（[https://aws.amazon.com/iam/details/mfa/](https://aws.amazon.com/iam/details/mfa/) ）。执行以下步骤进行设置：

1.  登录 AWS 管理控制台：[https://console.aws.amazon.com](https://console.aws.amazon.com) 。
2.  选择左侧菜单上的 Dashboard。
3.  在安全状态下，展开根帐户上的激活 MFA。
4.  选择激活 MFA 或管理 MFA。

5.  在向导中，选择虚拟 MFA 设备，然后选择继续。
6.  安装 MFA 应用程序，如 Authy（[https://authy.com/](https://authy.com/) ）。
7.  选择显示二维码，然后用智能手机扫描二维码。点击账户并生成一个亚马逊六位数代币。
8.  在 MFA 代码 1 框中键入六位数令牌。
9.  等待手机生成新令牌，该令牌每 30 秒生成一次。
10.  在 MFA 代码 2 框中键入六位数令牌。
11.  选择分配 MFA：

![](assets/a37f3ab6-3baa-4b56-bf66-c794fa4755f9.png)

# 使用密钥设置新用户

出于安全原因，我建议您仅使用根帐户进行计费！因此，首先要创建另一个权限更少的用户：

![](assets/842e7ecc-4612-4189-9399-49f2cbc09969.png)

使用以下步骤创建用户：

1.  登录 AWS 管理控制台（[https://console.aws.amazon.com/](https://console.aws.amazon.com/) ）。
2.  选择安全、身份和法规遵从性>IAM 或在“查找服务”下搜索 IAM。
3.  在 IAM 页面中，选择添加用户。
4.  在“设置用户详细信息”窗格中，键入“新用户”作为用户名。

5.  对于选择 AWS 访问类型，选中编程访问、AWS 控制台访问旁边的复选框。（可选）选择“自动生成密码”并要求密码休息。
6.  选择下一步：权限：

![](assets/319c4fb6-2d32-456a-a9e7-ce82457e6a5c.png)

按照以下步骤设置新用户的权限：

1.  选择创建组。
2.  在“创建组”对话框中，键入`Administrator`作为新组名。
3.  在策略列表中，选中 AdministratorAccess 旁边的复选框（请注意，对于非概念验证或非开发 AWS 环境，我建议使用更严格的访问策略）。
4.  选择创建组。

5.  选择“刷新”，并确保选中“管理员”旁边的复选框。
6.  选择下一步：标记。
7.  选择下一步：回顾。
8.  选择创建用户。
9.  选择 Download.csv 并记下密钥和密码。您将需要这些以编程方式访问帐户并以此用户身份登录。
10.  选择关闭。

More details on creating a new user can be found at [https://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started_create-admin-group.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started_create-admin-group.html).

与根帐户一样，我建议您启用 MFA：

1.  在管理控制台中，选择 IAM |用户并选择新用户。
2.  选择安全凭据选项卡，然后选择未分配的已分配 MFA 设备旁边的管理。
3.  选择虚拟 MFA 设备并选择“继续”。
4.  安装 MFA 应用程序，如 Authy（[https://authy.com/](https://authy.com/) ）。
5.  选择显示二维码，然后用智能手机扫描二维码。点击账户并生成一个亚马逊六位数代币。
6.  在 MFA 代码 1 框中键入六位数令牌。
7.  等待手机生成新令牌，该令牌每 30 秒生成一次。
8.  在 MFA 代码 2 框中键入六位数令牌。
9.  选择分配 MFA。

# 使用代码管理您的基础架构

使用 AWS 管理控制台中的 web 界面可以完成很多工作。这是一个很好的起点，可以帮助您了解正在构建的内容，但大多数情况下，不建议将其用于生产部署，因为它耗时且容易出现人为错误。最佳做法是仅使用代码和配置部署和管理基础架构。在本书中，我们将使用 AWS**命令行界面**（**CLI**）、bash shell 脚本和 Python 3，现在让我们来设置它们。

# 在 Windows 10 上安装 bash

如果您不使用 Windows，请跳过此步骤。

在部署和管理无服务器堆栈时，使用 bash（unixshell）可以使您的生活更加轻松。我认为所有分析师、数据科学家、架构师、管理员、数据库管理员、开发人员、DevOps 和技术人员都应该了解一些基本的 bash，并能够运行 shell 脚本，这些脚本通常在 Linux 和 Unix（包括 macOS 终端）上使用。

或者，您可以调整脚本以使用 MS-DOS 或 PowerShell，但这不是我推荐的，因为 bash 现在可以作为应用程序在 Windows 10 上本机运行，而且 bash 中还有更多联机示例。

注意，我已经去掉了`\r`或回车符，因为它们在 shell 脚本中是非法的。您可以使用记事本++（[等工具 https://notepad-plus-plus.org/ 如果您想在您的文件中正确查看回车，请在 Windows 上选择](https://notepad-plus-plus.org/)。如果您使用传统的 Windows 记事本，新行可能根本无法渲染，因此请使用记事本++，升华（[https://www.sublimetext.com/](https://www.sublimetext.com/) 、原子（[https://atom.io/](https://atom.io/) ），或其他编辑。

有关如何在 Windows 10 上安装 Linux Bash shell 的详细指南，请参见[https://www.howtogeek.com/249966/how-to-install-and-use-the-linux-bash-shell-on-windows-10/](https://www.howtogeek.com/249966/how-to-install-and-use-the-linux-bash-shell-on-windows-10/) 。主要步骤如下：

1.  导航至控制面板|程序|打开或关闭 Windows 功能。
2.  选中列表中 Windows Subsystem for Linux 选项旁边的复选框，然后选择 OK。
3.  导航到 Microsoft Store |在 Windows 上运行 Linux 并选择 Ubuntu。
4.  启动 Ubuntu 并使用用户名和密码设置根帐户 Windows`C:\`和其他驱动器已经安装，您可以通过终端中的以下命令访问它们：

```
$ cd /mnt/c/
```

很好，您现在可以在 Windows 上完全访问 Linux 了！

# 更新 Ubuntu，安装 Git 和 Python 3

本书稍后将使用 Git：

```
$ sudo apt-get update
$ sudo apt-get -y upgrade
$ apt-get install git-core
```

Lambda 代码是用 Python 3.6 编写的。`pip`是安装和管理 Python 包的工具。其他流行的 Python 包和依赖关系管理器也可用，例如 Conda（[https://conda.io/docs/index.html](https://conda.io/docs/index.html) 或 Pipenv（[https://pipenv.readthedocs.io/en/latest/](https://pipenv.readthedocs.io/en/latest/) ），但我们将使用 pip，因为它是安装 Python 包索引 PyPI（[中的包的推荐工具 https://pypi.org/](https://pypi.org/) ），并且是最广泛支持的：

```
$ sudo apt -y install python3.6
$ sudo apt -y install python3-pip
```

检查 Python 版本：

```
$ python --version
```

您应该获得 Python 版本 3.6+。

运行、测试和部署无服务器微服务所需的相关软件包列在每个项目文件夹下的`requirements.txt`中，可以使用`pip`安装：

```
$ sudo pip install -r /path/to/requirements.txt
```

这将安装用于本地开发的依赖库，例如 Boto3，它是 Python AWS**软件开发工具包**（**SDK**）。

在一些项目中，有一个名为`lambda-requirements.txt`的文件，其中包含 Lambda 部署时所需的第三方包。我们已经创建了另一个`requirements`文件，因为在 Lambda 部署到 AWS 时已经包含 Boto3 包，并且部署的 Lambda 不需要测试相关的库，例如`nose`或`locust`，这会增加包的大小。

# 安装和设置 AWS CLI

AWS CLI 用于打包和部署 Lambda 功能，以及以可重复的方式设置基础结构和安全性：

```
$ sudo pip install awscli --upgrade
```

您在前面创建了一个名为`newuser`的用户，并且有一个包含 AWS 密钥的`crednetials.csv`文件。通过运行`aws configure`输入：

```
$ aws configure
AWS Access Key ID: <the Access key ID from the csv>
AWS Secret Access Key: <the Secret access key from the csv>
Default region name: <your AWS region such as eu-west-1>
Default output format: <optional>
```

有关设置 AWS CLI 的更多详细信息，请参见 AWS 文档（[https://docs.aws.amazon.com/lambda/latest/dg/welcome.html](https://docs.aws.amazon.com/lambda/latest/dg/welcome.html) ）。

要选择您的 AWS 区域，请参考 AWS 区域和端点（[https://docs.aws.amazon.com/general/latest/gr/rande.html](https://docs.aws.amazon.com/general/latest/gr/rande.html) ）。一般来说，美国使用`us-east-1`，欧洲使用`eu-west-1`。

# 总结

在本章中，我们对单片和微服务体系结构进行了概述。然后我们讨论了设计模式和原则，以及它们与无服务器微服务的关系。我们还了解了如何设置 AWS 和开发环境，这将在本书中使用。

在下一章中，我们将创建一个无服务器微服务，它公开 RESTAPI，并能够查询使用 API 网关、Lambda 和 DynamoDB 构建的 NoSQL 存储。*