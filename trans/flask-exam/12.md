# 附录 A：对未来的窥视

在这本书中，我们涵盖了相当多的主题，并介绍了三个功能强大且有用的 web 应用程序的构建过程。然而，书籍本质上是有限长度的，而 web 开发的世界趋向于无限，因此我们无法添加所有内容。在最后一章中，我们将围绕我们无法详细介绍的技术进行一次短暂的参观。我们将从研究可以直接用于扩展或改进我们在本书中创建的项目的技术开始。然后，我们将了解一些更高级的 Flask 特性，这些特性在我们的项目中不需要使用，但在其他项目中几乎肯定会有用。最后，我们将简要讨论一些技术，这些技术通常对 web 开发很有用，但并不特定于我们在这里构建的项目或其他项目。

# 扩大项目

我们建造的项目都是功能性的，但它们还没有准备好用于大规模实时使用。如果它们是为了处理成千上万的用户而构建的，或者是商业应用程序，它们将需要更多的功能。这些将在以下章节中讨论。

## 添加域名

我们使用 VPS 的 IP 地址访问了我们所有的项目。您几乎肯定习惯于使用域名而不是 IP 地址访问 web 应用程序。当您使用域名时，如[http://google.com](http://google.com) ，您的浏览器首先向 DNS 服务器发送请求，以查找与此域关联的 IP 地址。DNS 服务器类似于巨大的自动电话簿，仅用于翻译人类更容易记住的域名（如[http://google.com](http://google.com) ）中的 IP 地址比组织 Internet 的 IP 地址（例如 123.456.789.123）多。

要使用域名而不是 IP 地址，您需要从注册商处购买一个。通常您的**互联网服务提供商**（**ISP**）可以帮助您购买域名（如`yourname.com`。域名通常相当便宜，你一年只需几美元就可以买到。

购买域名后，您需要正确设置 DNS 设置。大多数 ISP 都有一个在线控制面板，您可以自己进行操作，但您可能需要联系他们以提供帮助。您的域需要指向您的 VPS。为此，您需要创建一个“A”型 DNS 记录，将域映射到您的 IP。

一旦你的域名指向你的服务器，你就可以通过使用它来配置 Apache 来识别它，而不是我们在 Apache 配置文件中放置的`example.com`占位符，比如`/etc/apache2/sites-available/waitercaller.conf`。

对域名的更改也需要一段时间才能传播，也就是说，世界上主要的 DNS 服务器需要更新，以便当有人访问您的域名时，DNS 服务器可以将其重定向到您的 IP 地址。DNS 传播可能需要几个小时。

## 添加 HTTPS

你可能已经注意到银行、谷歌和微软等大公司以及越来越多的其他公司的网站自动重定向到**HTTPS**版本。“S”代表*安全*，因此全称为**超文本传输协议安全**。每当你在浏览器的导航栏中看到 HTTPS（通常旁边有一个绿色挂锁），这意味着你和服务器之间的所有流量都是加密的。这可以防止所谓的 AutoT8A.人在中间攻击，Ty9T.，在你和服务器之间的一个恶意 T10 恶意的人可以查看或修改你和服务器交换的内容。

直到最近，该加密还是由站点所有者通过从**证书颁发机构**（**CA**购买昂贵的证书来实现的。CA 的工作是充当您和服务器之间的可信第三方，向站点所有者颁发签名证书。此证书可用于在客户端和服务器之间设置加密通道。由于高昂的成本，HTTPS 仅在绝对需要安全性的情况下（例如，在网上银行中）以及像谷歌这样能够支付高额费用的公司使用。随着每个人都开始意识到基于信任的万维网模式本身存在缺陷，HTTPS 变得越来越流行，即使对于小型博客和个人网站也是如此。像 Let's Encrypt（[这样的公司 https://letsencrypt.org](https://letsencrypt.org) 现在免费提供证书，这些证书可以很容易地安装和配置，以便与流行的 web 服务器（如 Apache）一起使用。

对于我们的最后一个项目，当我们处理敏感数据（特别是密码）时，使用 HTTPS 对于我们的应用程序的非平凡使用是必须的，对于我们的其他两个项目也是可取的（HTTPS 总是优于 HTTP）。虽然现在设置证书以与 web 服务器一起工作的过程比几年前简单得多，但是如何设置 Apache2 以使用 CA 证书的完整演练超出了本书的范围。

但是，如果您只花时间了解本章中提到的一种技术，那么应该是这一种。这里是一个指向一个非常简单的数字海洋教程的链接，该教程向您展示了如何在 Ubuntu 14.04 上设置证书，以便使用 Apache2（我们在本书中使用的确切配置）：

[https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-14-04](https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-14-04)

## 新注册的电子邮件确认

您可能在我们的第三个项目中注意到，我们的注册过程有点不寻常。新用户在网站上注册的正常方式如下：

1.  用户填写登记表并提交。
2.  服务器将数据保存在数据库中。
3.  服务器生成一个唯一且安全的令牌，并存储与注册关联的令牌，并将其标记为未完成。
4.  服务器以 URL 的形式向用户发送令牌电子邮件，并请求用户单击 URL 以确认帐户。
5.  用户单击带有唯一标记的 URL。
6.  服务器发现与此令牌关联的注册不完整，并将注册标记为已确认。

前面的过程是为了证明用户给了我们一个他或她可以访问的真实电子邮件地址。当然，用户不希望等待某人手动发送电子邮件，因此必须自动发送确认电子邮件。这会导致一些复杂的问题，包括需要设置邮件服务器，以及我们发送的自动确认电子邮件可能最终会被放在用户的垃圾邮件文件夹中，从而导致所有方面的挫折感。另一种选择是使用*电子邮件即服务*平台，如亚马逊**简单电子邮件服务**（**SES**）。然而，这些通常不是免费的。

一旦用户拥有已确认的电子邮件帐户，我们还可以使用它允许用户重置忘记的密码。同样，这需要向想要重置密码的用户发送一封自动电子邮件。电子邮件将再次在 URL 中包含一个安全的唯一令牌，用户将单击该令牌以证明他或她确实提出了密码重置请求。然后，我们将允许用户输入一个新密码，并使用新的（哈希和盐析）密码更新数据库。注意，我们不能也不应该向用户发送他或她自己的密码，因为我们只存储加密和哈希版本的密码；我们没有办法发现被遗忘的那个。

具有自动电子邮件确认和“忘记密码”功能的完整用户帐户系统相当复杂。我们可以只使用 Python 和 Flask以及电子邮件服务器进行设置，但在下一节中，我们还将讨论一些可以使此过程更简单的 Flask 扩展。

## 谷歌分析

如果我们在商业上运行任何 web 应用程序，我们可能会对有多少人实际使用它们感兴趣。这将帮助我们决定如何（以及是否）将我们的应用程序货币化，并提供其他有用的见解。

实现这一点最常见的方法是通过谷歌分析。这是谷歌提供的一项服务，不仅可以跟踪有多少人访问你的网站，还可以跟踪他们在网站上花费的时间、他们是如何找到网站的、他们的国家、他们用于网络浏览的设备的信息，以及许多其他有见地的统计数据。谷歌分析是免费的，要开始使用它，你只需在[上创建一个帐户即可 https://analytics.google.com](https://analytics.google.com) （或使用您现有的谷歌账户）。在填写了一些关于站点的信息后，您将得到一小段 JavaScript。此 JavaScript 代码包含分配给站点的唯一跟踪 ID。您需要将 JavaScript 代码添加到您的站点，每当有人访问该站点时，JavaScript 代码将加载到他们的 web 浏览器中，并将有关他们的信息发送到 Google，Google 将使用唯一 ID 将信息与您关联。在 Google Analytics 仪表板上，您可以看到访问者数量、访问时间以及更多信息的图表。

在我们的侍者调用者项目中，我们将在`base.html`文件的末尾添加 JavaScript 以及引导 JavaScript 代码。

## 可伸缩性

作为一个 web 应用程序创建者，最好的问题是制作了一个过于流行的应用程序。如果有很多人访问你的应用程序，这意味着你创造了一些好东西（你可以开始向人们收费）。我们的小 VPS 无法处理大量的流量。如果数千人同时访问该站点，我们将很快耗尽网络带宽、处理能力、内存和磁盘空间。

关于创建可伸缩 web 应用程序的完整讨论将是一本完全独立的书。然而，我们需要采取的一些步骤是：

*   **在专用机器上运行数据库**：目前，我们在同一台物理机器上运行我们的 web 服务器和数据库。对于更大的 web 应用程序，数据库将有自己的专用机器，这样大量使用数据库（例如，许多餐馆顾客创建新请求）不会对那些只想浏览我们主页的人产生负面影响。通常情况下，数据库机器将拥有大量的磁盘空间和内存，而运行 web 服务器的机器将更加关注高带宽可用性和处理能力。
*   **运行负载均衡器**：如果我们有很多访客，一台机器无论多大、多强大都无法跟上负载。因此，我们将运行几个重复的 web 服务器机器。问题是在所有不同的机器之间平均分配新的访问者。为了解决这个问题，我们将使用一种称为*负载平衡器*的东西，它只负责接受用户的初始请求（即，当用户访问您的主页时），并将该用户分配到其中一个副本 web 服务器。

随着我们变得越来越大，情况会变得越来越复杂，我们也会添加副本数据库机器。一个流行的站点需要全职维护，通常由一组人来维护，因为硬件出现故障，存在恶意用户，而更新（这对于减轻恶意用户的攻击是必要的）往往会破坏软件之间的兼容性。好的一面是，如果任何 web 应用程序变得足够流行，足以保证前面的内容，那么该应用程序可能也会产生足够的收入，使讨论的所有问题都成为“SEP”或其他人的问题。也就是说，我们可以雇佣一名系统管理员、一名数据库管理员和一名首席安全官，让他们整理一下，然后在海上巡航上度过余下的日子。在这张便条上，让我们来看看一些特定于瓶子的扩展到我们的知识。

# 拓展你的知识面

你可能会认为，作为一个微观框架，烧瓶可以在一本书中完整地涵盖。然而，我们的三个项目中的任何一个都不需要 Flask 中一些潜在的非常有用的部分。我们将在这里简要概述这些。

## 虚拟人

值得一提的第一个库实际上不是特定于 Flask 的，如果您以前在 Python 开发上花了一些时间，您几乎肯定会遇到它。`VirtualEnv`是一个 Python 库，它在您的机器上创建一个虚拟 Python 环境。它可以仅在开发机器上或在开发机器和服务器上与 Flask 结合使用。它的主要目的是将整个 Python 环境隔离到一个虚拟环境中，包括您使用的所有 Python 模块。这有两大好处。首先，有时需要在同一台机器上运行两个不同的 Python 项目，但每个项目都需要相同库的不同版本。使用`VirtualEnv`，每个项目都会有自己的 Python 安装的虚拟化版本，因此安装同一个库的两个不同版本变得很简单。第二个优点是，您的环境变得更具可移植性，从理论上讲，将在`VirtualEnv`环境中运行的应用程序迁移到另一台安装了`VirtualEnv`的机器上很容易。

`VirtualEnv`环境被广泛用于 Python 开发，尤其是 Flask。我决定不把它列入书的主体，这一决定引起了书评人的高度争议，他们中的许多人认为没有它，这本书是不完整的。我决定不把它包括在内有两个原因。首先，当我学习 Flask 时，我阅读了许多教程和示例，其中包括 VirtualEnv。我总是发现在概述中设置和解释`VirtualEnv`和虚拟环境所需的额外工作会分散我对本教程主要内容的注意力（即使用 Flask）。第二个原因是，在我今天构建的 Flask 项目中，我仍然经常不使用它。如果您没有运行依赖于特定库的特定版本的旧软件，那么在系统范围内安装有用的 Python 库以便所有 Python 应用程序都可以使用它们是很方便的。此外，有时，VirtualEnv 可能只是成为一项任务，而没有提供任何价值。

当然，您可能已经对 VirtualEnv 有了自己的看法，在这种情况下，欢迎您加入。如果有一点经验，没有什么能阻止任何人在`VirtualEnv`环境中构建本书中的任何项目。如果您以前没有使用过它，那么它非常值得一看。您可以通过 pip 安装它，并进行试用，以了解它的具体功能，以及它是否可以在您的特定场景中使用。您可以在这里阅读更多关于它的信息以及如何使用它：

[http://docs.python-guide.org/en/latest/dev/virtualenvs/](http://docs.python-guide.org/en/latest/dev/virtualenvs/)

## 烧瓶蓝图

也许这本书中我们没有提到的烧瓶的最大特点是烧瓶蓝图。在构建了三个烧瓶应用程序之后，您必须注意到某些模式会一次又一次地出现。重复的代码是坏代码，即使在不同应用程序的数量上；如果您找到更好的方法来做某事，或者需要对更新进行一些更改，那么您不希望在多个应用程序之间进行相同的更改。

蓝图提供了一种为烧瓶应用程序指定模式的方法。如果有多个应用程序使用相同的代码返回模板或连接到数据库，则可以在蓝图中编写此通用代码，然后让所有应用程序注册蓝图。

您可以阅读更多关于烧瓶蓝图的信息，查看示例，并学习如何在[开始使用它们 http://flask.pocoo.org/docs/0.10/blueprints/](http://flask.pocoo.org/docs/0.10/blueprints/) 。

## 烧瓶加长件

在我们的三个项目中，我们研究了许多不同的烧瓶扩展。然而，由于本书的教育重点，我们选择从头开始编写一些代码，使用现有扩展可能会更好。（通常在开发时，我们希望避免重新发明轮子。如果其他人已经考虑过解决问题，并提供了一个开发良好且维护良好的解决方案，那么最好使用他们的产品，而不是尝试创建我们自己的产品。）特别令人感兴趣的是我们可以用来使我们的用户帐户系统更简单、功能更强大的扩展，以及那些为我们提供一种更抽象的方式来与我们的数据库通信的扩展。

### 炼金术

本书中另一个有争议的决定是不将 Flask SQLAlchemy 扩展与 MySQL 一起引入。SQLAlchemy 提供了一个 SQL 工具包和 ORM，使得从 Python 环境与 SQL 数据库交互更容易和更安全。ORM 在 web 应用程序和数据库之间提供了另一层抽象。不必直接编写 SQL 代码，您可以使用 Python 对象调用数据库，然后 ORM 将这些对象转换为 SQL 和 SQL。这使数据库更易于编写和维护，也更安全（ORM 通常非常擅长抵御任何潜在的 SQL 注入漏洞）。省略它的原因与学习时省略 VirtualEnv 的原因类似，太多的抽象层弊大于利，在盲目直接使用工具之前，对工具解决的问题有第一手的经验总是有利的。

对于任何使用 MySQL 数据库的 Flask 应用程序，例如我们的犯罪地图项目，强烈建议使用 ORM，就像大多数 Flask 扩展一样。Flask SQLAlchemy 只是现有非 Flask 特定库的包装器。你可以在[找到更多关于 SQLAlchemy 的信息 http://www.sqlalchemy.org/](http://www.sqlalchemy.org/) 和一个全面的炼金术指南，包括常见的使用模式，如下所示：

[http://flask.pocoo.org/docs/0.10/patterns/sqlalchemy/](http://flask.pocoo.org/docs/0.10/patterns/sqlalchemy/)

### MongoDB 扩展

有几个 Flask扩展旨在简化与 MongoDB 的接口。由于 MongoDB 相对较新，因此没有一款已经达到成熟程度，或者像 SQLAlchemy 那样被广泛使用；因此，如果您打算使用其中一种，建议您检查每一种，以确定哪一种最适合您的需要。

#### 摇瓶法

也许与 SQLAlchemy（不仅仅是名字）最相似的是烧瓶 MongoAlchemy。与 SQLAlchemy 类似，MongoAlchemy 不是特定于烧瓶的。您可以在[阅读更多关于主要项目的信息 http://www.mongoalchemy.org](http://www.mongoalchemy.org) 。Flask MongoAlchemy 是 MongoAlchemy 的一种烧瓶包装器，您可以在这里了解更多信息：

[http://pythonhosted.org/Flask-MongoAlchemy](http://pythonhosted.org/Flask-MongoAlchemy)

#### 皮蒙戈烧瓶

MongoDB 的一个更薄的包装器是 Flask PyMongo，它更接近于直接使用 PyMongo，就像我们在第三个项目中所做的那样。与 MongoAlchemy 不同，这并不提供 ORM 等价物；相反，它只是提供了一种通过 PyMongo 连接 MongoDB 的方式，使用的语法与 Flask通常处理外部资源的方式更加一致。您可以在 GitHub 页面上快速介绍 Flask PyMongo：

[https://github.com/dcrosta/flask-pymongo](https://github.com/dcrosta/flask-pymongo)

### 摇瓶发动机

将烧瓶与 MongoDB 结合使用的的另一种解决方案是 MongoEngine（[http://mongoengine.org](http://mongoengine.org) 。这是值得注意的，因为它集成了 WTForms 和 Flask 安全性，我们将在下面几节中讨论。您可以在[上阅读有关 Mongo Engine 的烧瓶专用扩展的更多信息 https://pypi.python.org/pypi/flask-mongoengine](https://pypi.python.org/pypi/flask-mongoengine) 。

### 邮件

如果我们想实现一个自动电子邮件发送解决方案，如本章前面所述，一个有用的扩展就是 Flask mail。这使您可以轻松地从 Flask 应用程序发送电子邮件，同时处理附件和批量邮件。如前所述，现在，考虑使用诸如亚马逊的 SES 的第三方服务，而不是自己发送电子邮件是值得的。您可以在[阅读更多关于烧瓶邮件的信息 http://pythonhosted.org/Flask-Mail](http://pythonhosted.org/Flask-Mail) 。

### 烧瓶安全

我们将讨论的最后一个扩展是烧瓶安全。这个扩展值得注意，因为它的很大一部分实际上是通过组合其他扩展来构建的。在某些方面，它背离了 Flask 的理念，即尽可能少地做有用的事情，并允许用户完全自由地进行自定义实现。它假设您使用的是我们描述的其中一个数据库框架，它将 Flask 登录、WTForms、Flask 邮件和其他扩展的功能整合在一起，试图使构建用户帐户控制系统尽可能简单。如果我们使用这个，我们将有一个集中的方式来处理注册帐户、登录帐户、加密密码和发送电子邮件，而不是让单独实现登录系统的每个部分。您可以在此处阅读有关 Flask 安全性的更多信息：

[https://pythonhosted.org/Flask-Security](https://pythonhosted.org/Flask-Security)

### 其他烧瓶延长件

有许多 Flask扩展，我们只强调了我们认为在许多 web 开发场景中普遍适用的扩展。当然，当您开发一个独特的 web 应用程序时，您会有更具体的需求，而且可能有人已经有了类似的需求，并且创建了一个解决方案。您可以在此处找到烧瓶扩展的广泛（但不完整）列表：

[http://flask.pocoo.org/extensions](http://flask.pocoo.org/extensions)

# 扩展您的 web 开发知识

在本书中，我们重点介绍了通过 Python 或 Flask 完成的后端开发。开发 web 应用程序的很大一部分是构建一个功能强大、美观且使用直观的前端。尽管我们在 HTML、CSS 和 JavaScript 方面提供了坚实的基础，但这些主题中的每一个都足以容纳自己的书，并且存在许多这样的书。

JavaScript 可能是这三种语言中最重要的一种。被称为“网络语言”，它在过去几年中稳步流行（尽管与所有语言一样，它也有相当份额的批评者）。有许多框架用于构建 JavaScript 密集型 web 应用程序（事实上，如此之多，以至于它们的数量和发布新应用程序的频率已经成为开发人员的一个幽默话题）。我们在本书中介绍了 Bootstrap，其中包括基本的 JavaScript 组件，但对于交互程度更高的应用程序，存在更大的框架。三个更流行的前端框架包括 AngularJS（由谷歌构建）、React.js（由 Facebook 构建）和 Ember.js（由包括雅虎在内的多家公司赞助）。学习这些框架中的任何一个或许多其他框架中的一个肯定会帮助您构建具有更丰富前端的更大、更复杂的 web 应用程序。

JavaScript 也不再局限于前端，许多现代 web 应用程序也在服务器端使用 JavaScript 构建。实现这一点的常用方法是通过 Node.js，它本可以在我们构建的任何项目中完全取代 Python 和 Flask。

HTML5 和 CSS3 的功能远远超过了它们从中发展而来的旧技术。早些时候，有一个明确的分工，内容是 HTML，样式是 CSS，动作是 JavaScript。现在，这三种技术的功能有了更多的重叠，一些令人印象深刻的交互式应用程序只使用 HTML5 和 CSS3 构建，而不使用 JavaScript。

# 总结

在本附录中，我们向前看并指出了一些关键领域和资源，这些领域和资源将帮助您超越本书中详细介绍的内容。我们在三个主题中讨论了这些领域：我们在本书中研究的项目，我们没有使用的 Flask 资源，以及一般的 web 开发。

这让我们走到了尽头。然而，技术的世界如此广阔，发展如此迅速，希望这更多的是一个开始而不是结束。当您继续您的冒险，学习更多关于生活、Python 和 web 开发的知识时，我希望本书中介绍的一些想法与您同在。